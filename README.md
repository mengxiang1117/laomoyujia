# 摸鱼网站 - 职场解压平台

## 项目概述

本项目是一个面向职场人士的摸鱼记录与分享平台，旨在帮助用户科学记录和分析自己的工作时间、摸鱼时间以及加班时间，通过数据可视化和社区互动，让摸鱼变得更加有趣和有意义。项目定位为职场解压工具，通过轻松幽默的方式帮助用户平衡工作与生活。

## 功能模块

### 1. 摸鱼设置页面
- 工作时间设置：用户可设置工作开始时间、结束时间，休息开始时间、结束时间及日薪
- 实时收益计算：根据用户设置的工作时间和薪资，实时计算并显示工作收益，按照秒进行更新，在前端实时展示
- 摸鱼记录：用户可记录摸鱼时长和具体项目，系统计算摸鱼收益  
- 加班记录：用户可记录加班时长和具体项目，系统计算加班负收益

### 2. 摸鱼技巧分享页面
- 技巧分享：用户可分享摸鱼技巧，包括具体步骤、注意事项和经验
- 技巧浏览：用户可查看其他用户分享的摸鱼技巧
- 互动功能：用户可对技巧进行点赞和评论

### 3. 排行榜页面
- 摸鱼排行榜：按摸鱼收益从高到低排序显示用户排名
- 红榜：显示摸鱼收益最高的前10名用户
- 黑榜：显示加班负收益最高的前10名用户

### 4. 个人页面
- 个人信息展示：包括工作时间、休息时间、薪资设置
- 个人信息修改：用户可以修改自己的个人信息，包括性别、年龄、工作、联系邮箱（均为选填，默认为空）
- 记录查看：展示用户的摸鱼记录、加班记录
- 技巧管理：展示用户分享的摸鱼技巧
- 技巧编辑与删除：用户可以编辑或删除自己分享的摸鱼技巧
- 排名信息：显示用户在排行榜中的位置

### 5. 意见和反馈页面
- 意见反馈：用户可以提交对网站的意见和建议
- 问题报告：用户可以报告在使用过程中遇到的问题
- 反馈查看：用户可以查看自己提交的反馈记录

## 核心功能

1. 用户注册和登录（用户名验证：不能重复，不能包含admin/Admin等大小写混合）
2. 工作时间和薪资设置与修改
3. 摸鱼记录和加班记录管理
4. 摸鱼技巧分享
5. 技巧浏览、点赞和评论
6. 排行榜展示
7. 个人信息管理与修改
8. 摸鱼技巧的编辑与删除
9. 意见反馈提交与管理

## 技术架构

- 数据库：PostgreSQL
- 后端：Python + Flask框架
- 前端：HTML/CSS/JavaScript
- 缓存：Redis
- 数据库：[supabase](https://supabase.com/)
- 在应用初始化文件中添加了Redis连接，为以下功能添加了缓存支持：
  - 实时收益计算（前后端同步）
  - 排行榜数据（缓存5分钟）
  - 技巧列表（缓存5分钟）
  - 技巧详情（缓存5分钟）
  - 用户个人资料（缓存5分钟）

## 依赖包

项目依赖以下Python 3.11+包：

- Flask - Web应用框架
- psycopg2 - PostgreSQL数据库连接
- python-dotenv- 环境变量加载
- redis - Redis连接

## 登录要求

**注意：除用户注册和登录功能外，本网站所有功能均需要用户登录后才能使用。**

- 未登录用户只能访问注册和登录页面
- 登录后用户可以使用所有功能模块，包括：
  - 主页面的工作时间设置和收益计算
  - 摸鱼记录和加班记录管理
  - 摸鱼技巧分享、浏览、点赞和评论
  - 排行榜查看
  - 个人信息管理和修改
  - 意见反馈提交和查看

## 安装和运行

1. 克隆项目到本地
2. 安装依赖包：
   ```
   pip install -r requirements.txt
   ```
3. 配置数据库连接信息（在.env文件中）
   ```
   cp env.example .env
   ```
4. 创建数据库表（运行sql_connect.py）
5. 优化数据库性能，建立索引（运行optimize_db.py）
6. 启动Redis服务
7. 运行应用：
   ```
   python run.py
   ```
   终端访问http://127.0.0.1:5000/

## 环境变量配置

项目需要以下环境变量，请在项目根目录创建.env文件并配置：

```
DB_HOST=your_database_host
DB_PORT=your_database_port
DB_NAME=your_database_name
DB_USER=your_database_user
DB_PASSWORD=your_database_password

# 兼容性变量
host=your_database_host
port=your_database_port
dbname=your_database_name
user=your_database_user
password=your_database_password
```